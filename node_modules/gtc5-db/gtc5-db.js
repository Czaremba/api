let mongodb = require("mongodb");
let MongoClient = mongodb.MongoClient;
let url = "mongodb://localhost:27017/gtc5";
if(process.env.NODE_ENV == "test")
  url += "-test";

var promise = MongoClient.connect(url).then(function(db){
  console.log("Connected to MongoDB");
  return db;
}).catch(function(err){
  console.error(err);
});

promise.deliveryUpdate = function(condition, update){
  return function(req, res, next){
    promise.then(function(db){
      return db.collection("deliveries").updateOne(condition(req), update(req));
    }).then(function(result){
      if(result.modifiedCount == 1)
        res.send({_id: req.params.deliveryId}); //maybe send status instead?
      else
        next("no such delivery");
    }).catch(next);
  }
}

module.exports = promise;
